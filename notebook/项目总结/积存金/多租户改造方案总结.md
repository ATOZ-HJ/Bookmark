### 多租户改造方案总结



### 前言

1. 基于多租户改造方案，了解多租户改造内容，对项目中涉及的改造点以及改造内容进行了解
   1. 如机构信息的判断，字段校验，接口 以及数据库字段添加等
2. 先了解项目架构，再对业务内容进行了解





### 改造内容

#### bc --->  bankadaptor  调用时，如何区分不同机构 ，使用feign的拦截器实现





#### 校验方法使用注解统一注入(渠道适配器层新增)：

1.  客户校验：渠道适配器层对涉及账户类查询接口，以及交易接口进行客户状态校验
2. 一级机构校验：校验一级机构代码是否存在请求参数中
3. 涉及交易的接口：交易接口或者涉及接口内逻辑包含交易的接口，需要通过注解的方式在请求参数中加入交易方法的名称



#### 校验方法使用注解统一注入(bc层新增)：







### 改造疑问

1. 多租户改造核心围绕的bankid进行，接口链路需要将bankid作为请求参数，逐级传到mapper层，从而对不同机构的数据进行筛选，我的理解是，bankId在请求参数中，类似在一个map缓存中，然后一直传，获取的时候都要从map或者对象中拿，还要关注需要向哪些bo或者map中设置bankid属性
2. 我的一些想法：bankid是一个用户信息，是否可以通过session，来在服务端保存，但是因为积存金集群，可能跨服务器，映像是session也不能跨服务器；使用token貌似挺好，登录后客户一直携带token，但是积存金没有使用jwt；后来我发现，使用redis是最好的了，但是有个问题，如果在redis中存储当前用户的bankId，我怎么获取到这个用户的信息呢，项目中也没有登录信息可以获取





### 技术栈使用

#### redis使用

1. pmts-cust服务启动时加载系统参数，并存放到redis中,当获取积存